<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <title>Kalimba</title>

    <link rel="shortcut icon" href="favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-21114316-10"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-21114316-10');
    </script>

    <script src='jquery-3.2.1.min.js'></script>
    <script src='Tone.min.js'></script>

    <script>
        //create a synth and connect it to the master output (your speakers)
        var config = {
            "_192": {
                "note": "e5",
                "key": {
                    "key": "`"
                },
                pan: -1
            },
            "_49": {
                "note": "c5",
                "key": {
                    "key": "1"
                },
                pan: -.9
            },
            "_50": {
                "note": "a4",
                "key": {
                    "key": "2"
                },
                pan: -.8
            },
            "_51": {
                "note": "f4",
                "key": {
                    "key": "3"
                },
                pan: -.7
            },
            "_52": {
                "note": "d4",
                "key": {
                    "key": "4"
                },
                pan: -.6
            },
            "_53": {
                "note": "bb3",
                "key": {
                    "key": "5"
                },
                pan: -.5
            },
            "_54": {
                "note": "a3",
                "key": {
                    "key": "6"
                },
                pan: .3
            },
            "_55": {
                "note": "c4",
                "key": {
                    "key": "7"
                },
                pan: .4
            },
            "_56": {
                "note": "e4",
                "key": {
                    "key": "8"
                },
                pan: .5
            },
            "_57": {
                "note": "g4",
                "key": {
                    "key": "9"
                },
                pan: .6
            },
            "_48": {
                "note": "bb4",
                "key": {
                    "key": "0"
                },
                pan: .7
            },
            "_189": {
                "note": "d5",
                "key": {
                    "key": "-"
                },
                pan: .8
            },
            "_187": {
                "note": "f5",
                "key": {
                    "key": "="
                },
                pan: .9
            },
            "_8": {
                "note": "a5",
                "key": {
                    "key": "backspace"
                },
                pan: 1
            },

            "_81": {
                "note": "bb4",
                "key": {
                    "key": "q"
                },
                pan: -.8
            },
            "_87": {
                "note": "g4",
                "key": {
                    "key": "w"
                },
                pan: -.7
            },
            "_69": {
                "note": "e4",
                "key": {
                    "key": "e"
                },
                pan: -.6
            },
            "_82": {
                "note": "c4",
                "key": {
                    "key": "r"
                },
                pan: -.5
            },
            "_84": {
                "note": "a3",
                "key": {
                    "key": "t"
                },
                pan: -.4
            },
            "_89": {
                "note": "g3",
                "key": {
                    "key": "y"
                },
                pan: -.3
            },
            "_85": {
                "note": "bb3",
                "key": {
                    "key": "u"
                },
                pan: .3
            },
            "_73": {
                "note": "d4",
                "key": {
                    "key": "i"
                },
                pan: .4
            },
            "_79": {
                "note": "f4",
                "key": {
                    "key": "o"
                },
                pan: .5
            },
            "_80": {
                "note": "a4",
                "key": {
                    "key": "p"
                },
                pan: .6
            },
            "_219": {
                "note": "c5",
                "key": {
                    "key": "["
                },
                pan: .7
            },
            "_221": {
                "note": "e5",
                "key": {
                    "key": "]"
                },
                pan: .8
            },
            "_65": {
                "note": "a4",
                "key": {
                    "key": "a"
                },
                pan: -.8
            },
            "_83": {
                "note": "f4",
                "key": {
                    "key": "s"
                },
                pan: -.7
            },
            "_68": {
                "note": "d4",
                "key": {
                    "key": "d"
                },
                pan: -.6
            },
            "_70": {
                "note": "bb3",
                "key": {
                    "key": "f"
                },
                pan: -.4
            },
            "_71": {
                "note": "g3",
                "key": {
                    "key": "g"
                },
                pan: -.3
            },
            "_72": {
                "note": "f3",
                "key": {
                    "key": "h"
                },
                pan: -.1
            },
            "_74": {
                "note": "a3",
                "key": {
                    "key": "j"
                },
                pan: .2
            },
            "_75": {
                "note": "c4",
                "key": {
                    "key": "k"
                },
                pan: .4
            },
            "_76": {
                "note": "e4",
                "key": {
                    "key": "l"
                },
                pan: .5
            },
            "_186": {
                "note": "g4",
                "key": {
                    "key": ";"
                },
                pan: .6
            },
            "_222": {
                "note": "bb4",
                "key": {
                    "key": "'"
                },
                pan: .7
            },
            "_220": {
                "note": "d5",
                "key": {
                    "key": "\\"
                },
                pan: -.1
            },
            "_13": {
                "note": "f5",
                "key": {
                    "key": "enter"
                },
                val: .1
            },

            "_90": {
                "note": "g4",
                "key": {
                    "key": "z"
                },
                pan: -.4
            },
            "_88": {
                "note": "e4",
                "key": {
                    "key": "x"
                },
                pan: -.3
            },
            "_67": {
                "note": "c4",
                "key": {
                    "key": "c"
                },
                pan: -.2
            },
            "_86": {
                "note": "a3",
                "key": {
                    "key": "v"
                },
                pan: -.1
            },
            "_66": {
                "note": "f3",
                "key": {
                    "key": "b"
                },
                pan: 0
            },
            "_78": {
                "note": "e3",
                "key": {
                    "key": "n"
                },
                pan: .1
            },
            "_77": {
                "note": "g3",
                "key": {
                    "key": "m"
                },
                pan: .2
            },
            "_188": {
                "note": "bb3",
                "key": {
                    "key": ","
                },
                pan: .3
            },
            "_190": {
                "note": "d4",
                "key": {
                    "key": "."
                },
                pan: .4
            },
            "_191": {
                "note": "f4",
                "key": {
                    "key": "/"
                },
                pan: .5
            },

            "_32": {
                "note": "f2",
                "key": {
                    "key": "s p a c e b a r"
                }
            }
        };

        var synthsByPan = {};

        var panVol = new Tone.PanVol(0, -3);
        var synth = new Tone.Synth(0);
        synth.chain(panVol, Tone.Master);

        for (var key in config) {
            var note = config[key];

            if (typeof note.pan === 'number') {
                var panSynth = synthsByPan[note.pan];
                if (!panSynth) {
                    var panPanVol = new Tone.PanVol(note.pan, -3);
                    panSynth = new Tone.Synth(0);
                    panSynth.chain(panPanVol, Tone.Master);
                }
                note.synth = panSynth;
            } else {
                note.synth = synth;
            }

        }

        // random
        var randomCodes = [65, 83, 68, 70, 71, 72, 74, 75, 76];

        function randomCode () {
            var rand = 0.5 + Math.random() * randomCodes.length;
            rand = Math.round(rand);
            return randomCodes[rand];
        }

        var octaveShift = 0;
        
        function tryPlay (which) {
            try {
                var noteOptions = config['_' + (typeof which === 'number' ? which : randomCode())];
                var note = noteOptions.note.match(/(\D+)(\d)$/);

                noteOptions.synth.triggerAttackRelease(note[1] + (+note[2] + octaveShift), '8n');
                return true;
            } catch (e) {
                // ignore
            }
        }

        $(function () {
           var $window = $(window), $document = $(document);

            var keyPressed = {};
            $document.on('keydown', function (event) {
                var which = event.which,
                    isKeydown = event.type === 'keydown';

                if (keyPressed[which]) return; // ignore
                keyPressed[which] = true;

                var played = tryPlay(isKeydown && which);

                switch (which) {
                   case 38:
                       octaveShift++;
                       break;
                   case 40:
                       octaveShift--;
                       break;
                }
           });

            $document.on('keyup', function (event) {
                var which = event.which;
                delete keyPressed[which];
            });

            console.info('(c) 2017 Art Polikarpov, artpolikarpov@gmail.com');
        });
    </script>
</head>
<body style="line-height: 1.6">
    <div style="position: absolute; top: 15%; left: 30%; z-index: 2; color: #333; font-family: Georgia;">
        <h1 style="color: blue;"><span style="background: blue; color: #fff; border-radius: 3px; padding: 0 3px;">Kalimba</span>.js</h1>
        <p>
            — press any key (on desktop or laptop)<br>
            — type this:<br>
            <span style="font-family: monospace; font-size: 1.2em; color: blue;">
                &nbsp;&nbsp;&nbsp;&nbsp;g d f s &nbsp; g d f s<br>
            &nbsp;&nbsp;&nbsp;&nbsp;h k j l &nbsp; j l  k ;<br>
            &nbsp;&nbsp;&nbsp;&nbsp;g d f s &nbsp; y i u o<br>
                &nbsp;&nbsp;&nbsp;&nbsp;lw ke jr th</span><br><br>
            — continue... find something new ✋
        </p>
        <br><br><hr>
        <p style="font-size: .9em; opacity: .6;">
            <strong>any key</strong> — some note to dicsover<br>
            <strong style="color: blue;">↑</strong> — octave up<br>
            <strong style="color: blue;">↓</strong> — octave down
        </p>
    </div>
</body>
</html>